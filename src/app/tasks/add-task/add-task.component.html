<div class="container">
    <div class="header">
        <h3>Taak aanmaken</h3>
    </div>


    <mat-vertical-stepper [linear]="false" #stepper>
        <mat-step [stepControl]="form">

            <app-client-searchbar (clientId)="getClientId($event)" *ngIf="!clientSelected"></app-client-searchbar>

            <div class="currentClient" *ngIf="currentClient">
                <mat-icon class="md-default-theme-theme material-icons action-icon close-button" role="img" aria-hidden="true" (click)="deselectClient()">close</mat-icon>

                {{currentClient.fullname}}
                <div *ngFor="let email of currentClient.emailaddress">
                    {{email.address}}
                </div>
                <div *ngFor="let phone of currentClient.phonenumber">{{phone.number}}</div>
                <div *ngFor="let address of currentClient.address">
                    {{address.fullAddress}}
                </div>
            </div>

            <form [formGroup]="form" (ngSubmit)="onSubmit(form.value)">
                <ng-template matStepLabel>Taak aanmaken</ng-template>

                <mat-form-field floatLabel="always" class="form-field" *ngIf="messageChannels">
                    <mat-label>Kanaal*</mat-label>
                    <mat-select formControlName="messageChannel">
                        <mat-option *ngFor="let messageChannel of messageChannels" [value]="messageChannel.name">
                            {{messageChannel.name }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field floatLabel="always" class="form-field" *ngIf="categories">
                    <mat-label>Categorie*</mat-label>
                    <mat-select formControlName="category">
                        <mat-option *ngFor="let category of categories" [value]="category.name">
                            {{category.name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field floatLabel="always" class="form-field" *ngIf="types">
                    <mat-label>Type*</mat-label>
                    <mat-select formControlName="type">
                        <mat-option *ngFor="let type of types" [value]="type.name">
                            {{type.name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field class="form-field" *ngIf="contactReasons">
                    <mat-label>Hoofdcontactreden*</mat-label>
                    <mat-select formControlName="contactReason" (selectionChange)="contactReasonToSubject()">
                        <mat-option *ngFor="let contactReason of contactReasons" [value]="contactReason.name">
                            {{contactReason.name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-checkbox [checked]="isChecked"
                              class="example-margin"
                              (change)="updateSubject()">
                    Gebruik contactreden als onderwerp
                </mat-checkbox>

                <mat-form-field class="form-field">
                    <input formControlName="subject"
                           matInput
                           placeholder="Onderwerp / Vraag"
                           [value]="isChecked ? contactReason : taskSubject"
                           (keyup)="isChecked = false">
                </mat-form-field>

                <mat-form-field>
                    <textarea formControlName="body"
                              class="message-body"
                              placeholder="Bericht (optioneel)"
                              matInput matTextareaAutosize matAutosizeMinRows=1 matAutosizeMaxRows=5>
                    </textarea>
                </mat-form-field>

                <button type="submit" mat-raised-button class="md-primary md-raised md-button md-default-theme-theme md-ink-ripple login" (click)="move(1, 'toewijzen')">Toewijzen</button>
                <button type="submit" mat-raised-button class="md-primary md-raised md-button md-default-theme-theme md-ink-ripple login" (click)="move(1, 'beantwoorden')">Beantwoorden</button>

            </form>
        </mat-step>

        <mat-step>
            <ng-template matStepLabel>Toewijzen/Beantwoorden</ng-template>
            <div class="toewijzen" *ngIf="action === 'toewijzen' && assigneeForm">
                <form [formGroup]="assigneeForm" (ngSubmit)="onSubmit2(assigneeForm.value)">
                    <mat-form-field floatLabel="always" class="form-field" *ngIf="categories">
                        <mat-label>Categorie*</mat-label>
                        <mat-select formControlName="category">
                            <mat-option *ngFor="let category of categories" [value]="category.name">
                                {{category.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <button type="submit" mat-raised-button class="md-primary md-raised md-button md-default-theme-theme md-ink-ripple login">done?</button>

                </form>
            </div>

            <div class="beantwoorden" *ngIf="action === 'beantwoorden' && assigneeForm">
                beantwoorden
            </div>


        </mat-step>
    </mat-vertical-stepper>
</div>
